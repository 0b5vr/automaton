<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>main.js - Documentation</title>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <span class="navicon"></span>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Automaton.html">Automaton</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="Automaton.html#__clock">__clock</a></li><li data-type='member'><a href="Automaton.html#__length">__length</a></li><li data-type='member'><a href="Automaton.html#__listeners">__listeners</a></li><li data-type='member'><a href="Automaton.html#__paramFxs">__paramFxs</a></li><li data-type='member'><a href="Automaton.html#__params">__params</a></li><li data-type='member'><a href="Automaton.html#__resolution">__resolution</a></li><li data-type='member'><a href="Automaton.html#__version">__version</a></li><li data-type='member'><a href="Automaton.html#deltaTime">deltaTime</a></li><li data-type='member'><a href="Automaton.html#fps">fps</a></li><li data-type='member'><a href="Automaton.html#isPlaying">isPlaying</a></li><li data-type='member'><a href="Automaton.html#length">length</a></li><li data-type='member'><a href="Automaton.html#loop">loop</a></li><li data-type='member'><a href="Automaton.html#progress">progress</a></li><li data-type='member'><a href="Automaton.html#realtime">realtime</a></li><li data-type='member'><a href="Automaton.html#resolution">resolution</a></li><li data-type='member'><a href="Automaton.html#time">time</a></li><li data-type='member'><a href="Automaton.html#version">version</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Automaton.html#__auto">__auto</a></li><li data-type='method'><a href="Automaton.html#__emit">__emit</a></li><li data-type='method'><a href="Automaton.html#addFx">addFx</a></li><li data-type='method'><a href="Automaton.html#auto">auto</a></li><li data-type='method'><a href="Automaton.html#load">load</a></li><li data-type='method'><a href="Automaton.html#on">on</a></li><li data-type='method'><a href="Automaton.html#pause">pause</a></li><li data-type='method'><a href="Automaton.html#play">play</a></li><li data-type='method'><a href="Automaton.html#precalcAll">precalcAll</a></li><li data-type='method'><a href="Automaton.html#seek">seek</a></li><li data-type='method'><a href="Automaton.html#update">update</a></li></ul></li><li><a href="AutomatonWithGUI.html">AutomatonWithGUI</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="AutomatonWithGUI.html#__clock">__clock</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__length">__length</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__listeners">__listeners</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__paramFxs">__paramFxs</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__params">__params</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__resolution">__resolution</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__version">__version</a></li><li data-type='member'><a href="AutomatonWithGUI.html#deltaTime">deltaTime</a></li><li data-type='member'><a href="AutomatonWithGUI.html#fps">fps</a></li><li data-type='member'><a href="AutomatonWithGUI.html#isPlaying">isPlaying</a></li><li data-type='member'><a href="AutomatonWithGUI.html#length">length</a></li><li data-type='member'><a href="AutomatonWithGUI.html#loop">loop</a></li><li data-type='member'><a href="AutomatonWithGUI.html#progress">progress</a></li><li data-type='member'><a href="AutomatonWithGUI.html#realtime">realtime</a></li><li data-type='member'><a href="AutomatonWithGUI.html#resolution">resolution</a></li><li data-type='member'><a href="AutomatonWithGUI.html#time">time</a></li><li data-type='member'><a href="AutomatonWithGUI.html#version">version</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="AutomatonWithGUI.html#__auto">__auto</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__dropHistory">__dropHistory</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__emit">__emit</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__operate">__operate</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__prepareGUI">__prepareGUI</a></li><li data-type='method'><a href="AutomatonWithGUI.html#addFx">addFx</a></li><li data-type='method'><a href="AutomatonWithGUI.html#auto">auto</a></li><li data-type='method'><a href="AutomatonWithGUI.html#countParams">countParams</a></li><li data-type='method'><a href="AutomatonWithGUI.html#createParam">createParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#deleteParam">deleteParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#getParamNames">getParamNames</a></li><li data-type='method'><a href="AutomatonWithGUI.html#load">load</a></li><li data-type='method'><a href="AutomatonWithGUI.html#on">on</a></li><li data-type='method'><a href="AutomatonWithGUI.html#pause">pause</a></li><li data-type='method'><a href="AutomatonWithGUI.html#play">play</a></li><li data-type='method'><a href="AutomatonWithGUI.html#precalcAll">precalcAll</a></li><li data-type='method'><a href="AutomatonWithGUI.html#redo">redo</a></li><li data-type='method'><a href="AutomatonWithGUI.html#save">save</a></li><li data-type='method'><a href="AutomatonWithGUI.html#seek">seek</a></li><li data-type='method'><a href="AutomatonWithGUI.html#setLength">setLength</a></li><li data-type='method'><a href="AutomatonWithGUI.html#togglePlay">togglePlay</a></li><li data-type='method'><a href="AutomatonWithGUI.html#undo">undo</a></li><li data-type='method'><a href="AutomatonWithGUI.html#update">update</a></li></ul></li><li><a href="Clock.html">Clock</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Clock.html#pause">pause</a></li><li data-type='method'><a href="Clock.html#play">play</a></li><li data-type='method'><a href="Clock.html#setTime">setTime</a></li><li data-type='method'><a href="Clock.html#update">update</a></li></ul></li><li><a href="ClockFrame.html">ClockFrame</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ClockFrame.html#pause">pause</a></li><li data-type='method'><a href="ClockFrame.html#play">play</a></li><li data-type='method'><a href="ClockFrame.html#setTime">setTime</a></li><li data-type='method'><a href="ClockFrame.html#update">update</a></li></ul></li><li><a href="ClockRealtime.html">ClockRealtime</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ClockRealtime.html#pause">pause</a></li><li data-type='method'><a href="ClockRealtime.html#play">play</a></li><li data-type='method'><a href="ClockRealtime.html#setTime">setTime</a></li><li data-type='method'><a href="ClockRealtime.html#update">update</a></li></ul></li><li><a href="Param.html">Param</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="Param.html#__automaton">__automaton</a></li><li data-type='member'><a href="Param.html#__fxs">__fxs</a></li><li data-type='member'><a href="Param.html#__lastTime">__lastTime</a></li><li data-type='member'><a href="Param.html#__lastValue">__lastValue</a></li><li data-type='member'><a href="Param.html#__nodes">__nodes</a></li><li data-type='member'><a href="Param.html#__values">__values</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Param.html#getValue">getValue</a></li><li data-type='method'><a href="Param.html#load">load</a></li><li data-type='method'><a href="Param.html#precalc">precalc</a></li></ul></li><li><a href="ParamWithGUI.html">ParamWithGUI</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ParamWithGUI.html#__sortNodes">__sortNodes</a></li><li data-type='method'><a href="ParamWithGUI.html#__validateNodeIndex">__validateNodeIndex</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">main.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Clock from './clock';
import ClockFrame from './clock-frame';
import ClockRealtime from './clock-realtime';

import Param from './param';

/**
 * IT'S AUTOMATON!
 * It's `automaton.nogui.js` version and also base class for {@link AutomatonWithGUI}.
 * @param {Object} _props
 * @param {boolean} [_props.loop] Whether let the time loop or not
 * @param {number} [_props.fps] If this is set, the clock will become frame mode
 * @param {boolean} [_props.realtime] If this is true, the clock will become realtime mode
 * @param {Object} _props.data Data of the automaton. **Required in noGUI mode**
 */
let Automaton = class {
  constructor( _props ) {
    /**
     * Version of the automaton.
     * @type {number}
     * @protected
     */
    this.__version = process.env.VERSION;

    /**
     * Whether the animation will be looped or not.
     * @type {boolean}
     */
    this.loop = _props.loop || false;

    /**
     * Clock of the automaton.
     * @type {Clock}
     * @protected
     */
    this.__clock = (
      _props.fps ? new ClockFrame( this, _props.fps ) :
      _props.realtime ? new ClockRealtime( this ) :
      new Clock( this )
    );

    const data = _props.data;
    this.load( data );

    /**
     * **THE MIGHTY `auto()` FUNCTION!! GRAB IT**
     * It creates a new param automatically if there are no param called `_name` (GUI mode only).
     * Otherwise it returns current value of the param called `_name`.
     * @param {string} _name name of the param
     * @returns {number} Current value of the param
     */
    this.auto = ( _name ) => this.__auto( _name );

    /**
     * A list of param fxs.
     * @type {Fx[]}
     * @protected
     */
    this.__paramFxs = {};

    /**
     * List of event listeners.
     * @type {Object.&lt;string, function[]>}
     */
    this.__listeners = {};
  }

  /**
   * Version of the automaton.
   * @type {number}
   * @readonly
   */
  get version() { return this.__version; }

  /**
   * Current time. Same as `automaton.__clock.time`.
   * @type {number}
   * @readonly
   */
  get time() { return this.__clock.time; }

  /**
   * Total length of animation in seconds.
   * @type {number}
   * @readonly
   */
  get length() { return this.__length; }

  /**
   * Resolution = Sampling point per second.
   * @type {number}
   * @readonly
   */
  get resolution() { return this.__resolution; }

  /**
   * Delta of time between now and previous update call.
   * @type {number}
   * @readonly
   */
  get deltaTime() { return this.__clock.deltaTime; }

  /**
   * Whether it's playing or not.
   * @type {boolean}
   * @readonly
   */
  get isPlaying() { return this.__clock.isPlaying; }

  /**
   * Current progress by whole length. Might NOT be [0-1] unless `_props.loop` (see constructor) is true.
   * @type {number}
   * @readonly
   */
  get progress() { return this.time / this.length; }

  /**
   * Frame per second. If the clock type is not fps, it will return `0` instead.
   * @type {number}
   * @readonly
   */
  get fps() { return this.__clock.fps ? this.__clock.fps : 0; }

  /**
   * Boolean that represents whether the clock is based on realtime or not.
   * @type {boolean}
   * @readonly
   */
  get realtime() { return Boolean( this.__clock.realtime ); }

  /**
   * Load automaton state data.
   * @param {Object} _data Object contains automaton data.
   */
  load( _data ) {
    /**
     * Total length of animation in seconds.
     * @type {number}
     * @protected
     */
    this.__length = _data.length;

    /**
     * Resolution = Sampling point per second.
     * @type {number}
     * @protected
     */
    this.__resolution = _data.resolution;

    /**
     * List of Param.
     * @type {Object.&lt;string, Param>}
     * @protected
     */
    this.__params = {};
    for ( const name in _data.params ) {
      let param = new Param( {
        automaton: this,
        data: _data.params[ name ]
      } );
      this.__params[ name ] = param;
    }
  }

  /**
   * Seek the timeline.
   * Can be performed via GUI.
   * @param {number} _time Time
   */
  seek( _time ) {
    this.__clock.setTime( _time );
    this.__emit( 'seek' );
  }

  /**
   * Play the timeline.
   * @todo SHOULD be performed via GUI.
   */
  play() {
    this.__clock.play();
    this.__emit( 'play' );
  }

  /**
   * Pause the timeline.
   * @todo SHOULD be performed via GUI.
   */
  pause() {
    this.__clock.pause();
    this.__emit( 'pause' );
  }

  /**
   * Add a fx.
   * @param {Fx} _fx Fx object
   */
  addFx( _fx ) {
    this.__paramFxs[ _fx.name ] = _fx;
  }

  /**
   * Emit an event.
   * @param {string} _event Event name
   * @param {...any} _arg Arguments passed to listeners
   * @protected
   */
  __emit( _event, ..._arg ) {
    if ( !this.__listeners[ _event ] ) { return; }
    this.__listeners[ _event ].map( ( listener ) => listener( ..._arg ) );
  }

  /**
   * Register a listener function.
   * @param {string} _event Event name
   * @param {function} _func Listener function
   */
  on( _event, _func ) {
    if ( !this.__listeners[ _event ] ) {
      this.__listeners[ _event ] = [];
    }
    this.__listeners[ _event ].push( _func );
  }

  /**
   * Precalculate all params.
   */
  precalcAll() {
    for ( const name in this.__params ) {
      this.__params[ name ].precalc();
    }
  }

  /**
   * Update the entire automaton.
   * **You may want to call this in your update loop.**
   * @param {number} [_time] Current time, **Required if the clock mode is manual**
   */
  update( _time ) {
    // update the clock
    this.__clock.update( _time );

    // if loop is enabled, loop the time
    if ( this.loop &amp;&amp; this.length &lt; this.time ) {
      this.__clock.setTime( this.time - Math.floor( this.time / this.length ) * this.length );
    }

    // grab current value for each param
    for ( let name in this.__params ) {
      this.__params[ name ].getValue();
    }
  }

  /**
   * Assigned to Automaton.auto at constructor.
   * @param {string} _name name of the param
   * @returns {number} Current value of the param
   * @protected
   */
  __auto( _name ) {
    return this.params[ _name ].__currentValue;
  }
};

module.exports = Automaton;
Automaton.default = Automaton;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc" target="_blank">JSDoc 3.5.5</a> on 7/9/2018 using the <a href="https://github.com/Grafluxe/boxy-jsdoc-template" target="_blank">boxy-jsdoc-template</a> theme.
</footer>

<script src="scripts/prettify/prettify.js"></script>
<script src="scripts/prettify/lang-css.js"></script>
<script src="scripts/script.js"></script>

</body>
</html>
