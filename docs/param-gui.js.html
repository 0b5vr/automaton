<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>param-gui.js - Documentation</title>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <span class="navicon"></span>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Automaton.html">Automaton</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="Automaton.html#__clock">__clock</a></li><li data-type='member'><a href="Automaton.html#__length">__length</a></li><li data-type='member'><a href="Automaton.html#__listeners">__listeners</a></li><li data-type='member'><a href="Automaton.html#__paramFxs">__paramFxs</a></li><li data-type='member'><a href="Automaton.html#__params">__params</a></li><li data-type='member'><a href="Automaton.html#__resolution">__resolution</a></li><li data-type='member'><a href="Automaton.html#__version">__version</a></li><li data-type='member'><a href="Automaton.html#deltaTime">deltaTime</a></li><li data-type='member'><a href="Automaton.html#fps">fps</a></li><li data-type='member'><a href="Automaton.html#isPlaying">isPlaying</a></li><li data-type='member'><a href="Automaton.html#length">length</a></li><li data-type='member'><a href="Automaton.html#loop">loop</a></li><li data-type='member'><a href="Automaton.html#progress">progress</a></li><li data-type='member'><a href="Automaton.html#realtime">realtime</a></li><li data-type='member'><a href="Automaton.html#resolution">resolution</a></li><li data-type='member'><a href="Automaton.html#time">time</a></li><li data-type='member'><a href="Automaton.html#version">version</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Automaton.html#__auto">__auto</a></li><li data-type='method'><a href="Automaton.html#__emit">__emit</a></li><li data-type='method'><a href="Automaton.html#addFx">addFx</a></li><li data-type='method'><a href="Automaton.html#auto">auto</a></li><li data-type='method'><a href="Automaton.html#createParam">createParam</a></li><li data-type='method'><a href="Automaton.html#load">load</a></li><li data-type='method'><a href="Automaton.html#on">on</a></li><li data-type='method'><a href="Automaton.html#pause">pause</a></li><li data-type='method'><a href="Automaton.html#play">play</a></li><li data-type='method'><a href="Automaton.html#precalcAll">precalcAll</a></li><li data-type='method'><a href="Automaton.html#seek">seek</a></li><li data-type='method'><a href="Automaton.html#update">update</a></li></ul></li><li><a href="AutomatonWithGUI.html">AutomatonWithGUI</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="AutomatonWithGUI.html#__clock">__clock</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__length">__length</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__listeners">__listeners</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__paramFxs">__paramFxs</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__params">__params</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__resolution">__resolution</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__version">__version</a></li><li data-type='member'><a href="AutomatonWithGUI.html#__vue">__vue</a></li><li data-type='member'><a href="AutomatonWithGUI.html#deltaTime">deltaTime</a></li><li data-type='member'><a href="AutomatonWithGUI.html#fps">fps</a></li><li data-type='member'><a href="AutomatonWithGUI.html#isPlaying">isPlaying</a></li><li data-type='member'><a href="AutomatonWithGUI.html#length">length</a></li><li data-type='member'><a href="AutomatonWithGUI.html#loop">loop</a></li><li data-type='member'><a href="AutomatonWithGUI.html#progress">progress</a></li><li data-type='member'><a href="AutomatonWithGUI.html#realtime">realtime</a></li><li data-type='member'><a href="AutomatonWithGUI.html#resolution">resolution</a></li><li data-type='member'><a href="AutomatonWithGUI.html#time">time</a></li><li data-type='member'><a href="AutomatonWithGUI.html#version">version</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="AutomatonWithGUI.html#__auto">__auto</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__emit">__emit</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__prepareGUI">__prepareGUI</a></li><li data-type='method'><a href="AutomatonWithGUI.html#addFx">addFx</a></li><li data-type='method'><a href="AutomatonWithGUI.html#auto">auto</a></li><li data-type='method'><a href="AutomatonWithGUI.html#countParams">countParams</a></li><li data-type='method'><a href="AutomatonWithGUI.html#createParam">createParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#deleteParam">deleteParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#dropHistory">dropHistory</a></li><li data-type='method'><a href="AutomatonWithGUI.html#getParam">getParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#getParamNames">getParamNames</a></li><li data-type='method'><a href="AutomatonWithGUI.html#load">load</a></li><li data-type='method'><a href="AutomatonWithGUI.html#on">on</a></li><li data-type='method'><a href="AutomatonWithGUI.html#pause">pause</a></li><li data-type='method'><a href="AutomatonWithGUI.html#play">play</a></li><li data-type='method'><a href="AutomatonWithGUI.html#precalcAll">precalcAll</a></li><li data-type='method'><a href="AutomatonWithGUI.html#pushHistory">pushHistory</a></li><li data-type='method'><a href="AutomatonWithGUI.html#redo">redo</a></li><li data-type='method'><a href="AutomatonWithGUI.html#save">save</a></li><li data-type='method'><a href="AutomatonWithGUI.html#seek">seek</a></li><li data-type='method'><a href="AutomatonWithGUI.html#setLength">setLength</a></li><li data-type='method'><a href="AutomatonWithGUI.html#togglePlay">togglePlay</a></li><li data-type='method'><a href="AutomatonWithGUI.html#undo">undo</a></li><li data-type='method'><a href="AutomatonWithGUI.html#update">update</a></li></ul></li><li><a href="Clock.html">Clock</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Clock.html#pause">pause</a></li><li data-type='method'><a href="Clock.html#play">play</a></li><li data-type='method'><a href="Clock.html#setTime">setTime</a></li><li data-type='method'><a href="Clock.html#update">update</a></li></ul></li><li><a href="ClockFrame.html">ClockFrame</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ClockFrame.html#pause">pause</a></li><li data-type='method'><a href="ClockFrame.html#play">play</a></li><li data-type='method'><a href="ClockFrame.html#setTime">setTime</a></li><li data-type='method'><a href="ClockFrame.html#update">update</a></li></ul></li><li><a href="ClockRealtime.html">ClockRealtime</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ClockRealtime.html#pause">pause</a></li><li data-type='method'><a href="ClockRealtime.html#play">play</a></li><li data-type='method'><a href="ClockRealtime.html#setTime">setTime</a></li><li data-type='method'><a href="ClockRealtime.html#update">update</a></li></ul></li><li><a href="Param.html">Param</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="Param.html#__automaton">__automaton</a></li><li data-type='member'><a href="Param.html#__fxs">__fxs</a></li><li data-type='member'><a href="Param.html#__lastTime">__lastTime</a></li><li data-type='member'><a href="Param.html#__lastValue">__lastValue</a></li><li data-type='member'><a href="Param.html#__nodes">__nodes</a></li><li data-type='member'><a href="Param.html#__values">__values</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Param.html#getValue">getValue</a></li><li data-type='method'><a href="Param.html#load">load</a></li><li data-type='method'><a href="Param.html#precalc">precalc</a></li></ul></li><li><a href="ParamWithGUI.html">ParamWithGUI</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="ParamWithGUI.html#.DEFAULT_HANDLE_LENGTH">DEFAULT_HANDLE_LENGTH</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ParamWithGUI.html#__set">__set</a></li><li data-type='method'><a href="ParamWithGUI.html#__sortNodes">__sortNodes</a></li><li data-type='method'><a href="ParamWithGUI.html#__validateNodeIndex">__validateNodeIndex</a></li><li data-type='method'><a href="ParamWithGUI.html#createNode">createNode</a></li><li data-type='method'><a href="ParamWithGUI.html#createNodeFromData">createNodeFromData</a></li><li data-type='method'><a href="ParamWithGUI.html#dumpNode">dumpNode</a></li><li data-type='method'><a href="ParamWithGUI.html#getNumNode">getNumNode</a></li><li data-type='method'><a href="ParamWithGUI.html#moveHandle">moveHandle</a></li><li data-type='method'><a href="ParamWithGUI.html#moveNode">moveNode</a></li><li data-type='method'><a href="ParamWithGUI.html#precalc">precalc</a></li><li data-type='method'><a href="ParamWithGUI.html#removeNode">removeNode</a></li><li data-type='method'><a href="ParamWithGUI.html#resetHandle">resetHandle</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">param-gui.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import jsonCopy from './json-copy';
import ass from './ass';

import Automaton from './main-gui';
import Param from './param';

import Vue from 'vue';

/**
 * It represents a param of Automaton.
 * It's `automaton.js` and `automaton.min.js` version.
 * It has even more pretty APIs yay
 * @param {Object} _props
 * @param {Automaton} _props.automaton Parent automaton
 * @param {Object} [_props.data] Data of the param. Don't worry, I can generate an initial data for you!
 */
let ParamWithGUI = class extends Param {
  constructor( _props ) {
    let props = Object.assign( {}, _props );
    const len = _props.automaton.length;
    props.data = props.data ? props.data : {
      nodes: [
        {
          time: 0.0,
          value: 0.0,
          out: { time: ParamWithGUI.DEFAULT_HANDLE_LENGTH, value: 0.0 }
        },
        {
          time: len,
          value: 0.0,
          in: { time: -ParamWithGUI.DEFAULT_HANDLE_LENGTH, value: 0.0 }
        }
      ],
      fxs: []
    };

    super( props );
  }

  /**
   * If the index of node is invalid, throw an error.
   * @param {number} _index Index of node
   * @protected
   */
  __validateNodeIndex( _index ) {
    ass(
      0 &lt;= _index &amp;&amp; _index &lt; this.__nodes.length,
      'Invalid node index: ' + _index
    );
  }

  /**
   * Sort nodes by time.
   * @protected
   */
  __sortNodes() {
    this.__nodes.sort( ( a, b ) => a.time - b.time );
  }

  /**
   * Set a property to an object / array;
   * @param {Object|Array} _target Target object / array
   * @param {number|string} _key Key
   * @param {any} _value Value
   * @protected
   */
  __set( _target, _key, _value ) {
    Vue.set( _target, _key, _value );
  }

  /**
   * Return how many node the param currently have.
   */
  getNumNode() {
    return this.__nodes.length;
  }

  /**
   * Precalculate values.
   */
  precalc() {
    super.precalc();

    if ( this.__automaton.__vue ) {
      this.__automaton.__vue.$emit( 'precalc' );
    }
  }

  /**
   * Dump data of a node.
   * @param {number} _index Index of a node you want to dump
   * @returns {object} Data of the node
   */
  dumpNode( _index ) {
    return jsonCopy( this.__nodes[ _index ] );
  }
  
  /**
   * Create a node.
   * @param {number} _time Time of new node
   * @param {number} _value Value of new node
   * @returns {number} Index of the new node
   */
  createNode( _time, _value ) {
    const data = {
      time: _time,
      value: _value,
      in: { time: -ParamWithGUI.DEFAULT_HANDLE_LENGTH, value: 0.0 },
      out: { time: ParamWithGUI.DEFAULT_HANDLE_LENGTH, value: 0.0 }
    };
    this.__nodes.push( data );
    this.__sortNodes();

    this.precalc();

    return this.__nodes.indexOf( data );
  }

  /**
   * Create a node from dumped data.
   * @param {object} _obj Dumped node data
   */
  createNodeFromData( _obj ) {
    this.__nodes.push( jsonCopy( _obj ) );
    this.__sortNodes();

    this.precalc();
  }

  /**
   * Remove a node.
   * @param {number} _index Index of node
   */
  removeNode( _index ) {
    this.__validateNodeIndex( _index );

    this.__nodes.splice( _index, 1 );

    this.precalc();
  }

  /**
   * Move a node.
   * @param {number} _index Index of node
   * @param {number} _time Time
   * @param {number} _value Value
   */
  moveNode( _index, _time, _value ) {
    this.__validateNodeIndex( _index );

    let node = this.__nodes[ _index ];

    let time = typeof _time === 'number' ? _time : node.time;
    if ( _index === 0 ) {
      time = 0;
    } else if ( _index === this.__nodes.length - 1 ) {
      time = this.__automaton.length;
    } else {
      time = Math.min( Math.max( time, this.__nodes[ _index - 1 ].time ), this.__nodes[ _index + 1 ].time );
    }
    node.time = time;

    node.value = typeof _value === 'number' ? _value : node.value;

    this.precalc();
  }

  /**
   * Move a handle of a node.
   * @param {number} _index Index of node
   * @param {boolean} _isOut Input handle if false, output handle if true
   * @param {number} _time Time
   * @param {number} _value Value
   */
  moveHandle( _index, _isOut, _time, _value ) {
    this.__validateNodeIndex( _index );

    if (
      ( _index === 0 &amp;&amp; ( !_isOut ) ) ||
      ( _index === ( this.getNumNode() - 1 ) &amp;&amp; _isOut )
    ) { return; }

    let node = this.__nodes[ _index ];
    let handle = _isOut ? node.out : node.in;

    let time = typeof _time === 'number' ? _time : handle.time;
    if ( _isOut ) {
      time = Math.max( 0.0, time );
    } else {
      time = Math.min( 0.0, time );
    }
    handle.time = time;

    handle.value = typeof _value === 'number' ? _value : handle.value;

    this.precalc();
  }

  /**
   * Reset a handle of a node.
   * @param {number} _index Index of node
   * @param {boolean} _isOut Input handle if false, output handle if true
   */
  resetHandle( _index, _isOut ) {
    this.__validateNodeIndex( _index );

    if (
      ( _index === 0 &amp;&amp; ( !_isOut ) ) ||
      ( _index === ( this.getNumNode() - 1 ) &amp;&amp; _isOut )
    ) { return; }

    let node = this.__nodes[ _index ];
    let handle = _isOut ? node.out : node.in;

    handle.time = ( _isOut ? 1.0 : -1.0 ) * ParamWithGUI.DEFAULT_HANDLE_LENGTH;
    handle.value = 0.0;
    
    this.precalc();
  }
};

/**
 * Handles of a new node will be created in this length.
 * @type {number}
 * @constant
 */
ParamWithGUI.DEFAULT_HANDLE_LENGTH = 0.5;

export default ParamWithGUI;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc" target="_blank">JSDoc 3.5.5</a> on 7/23/2018 using the <a href="https://github.com/Grafluxe/boxy-jsdoc-template" target="_blank">boxy-jsdoc-template</a> theme.
</footer>

<script src="scripts/prettify/prettify.js"></script>
<script src="scripts/prettify/lang-css.js"></script>
<script src="scripts/script.js"></script>

</body>
</html>
