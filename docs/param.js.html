<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>param.js - Documentation</title>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <span class="navicon"></span>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Automaton.html">Automaton</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="Automaton.html#deltaTime">deltaTime</a></li><li data-type='member'><a href="Automaton.html#isPlaying">isPlaying</a></li><li data-type='member'><a href="Automaton.html#progress">progress</a></li><li data-type='member'><a href="Automaton.html#time">time</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Automaton.html#__auto">__auto</a></li><li data-type='method'><a href="Automaton.html#__loadProps">__loadProps</a></li><li data-type='method'><a href="Automaton.html#auto">auto</a></li><li data-type='method'><a href="Automaton.html#pause">pause</a></li><li data-type='method'><a href="Automaton.html#play">play</a></li><li data-type='method'><a href="Automaton.html#seek">seek</a></li><li data-type='method'><a href="Automaton.html#update">update</a></li></ul></li><li><a href="AutomatonWithGUI.html">AutomatonWithGUI</a><ul class='members'><li class='list-title'>Members</li><li data-type='member'><a href="AutomatonWithGUI.html#deltaTime">deltaTime</a></li><li data-type='member'><a href="AutomatonWithGUI.html#isPlaying">isPlaying</a></li><li data-type='member'><a href="AutomatonWithGUI.html#progress">progress</a></li><li data-type='member'><a href="AutomatonWithGUI.html#time">time</a></li></ul><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="AutomatonWithGUI.html#__auto">__auto</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__dropHistory">__dropHistory</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__loadProps">__loadProps</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__operate">__operate</a></li><li data-type='method'><a href="AutomatonWithGUI.html#__prepareGUI">__prepareGUI</a></li><li data-type='method'><a href="AutomatonWithGUI.html#auto">auto</a></li><li data-type='method'><a href="AutomatonWithGUI.html#countParams">countParams</a></li><li data-type='method'><a href="AutomatonWithGUI.html#createParam">createParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#deleteParam">deleteParam</a></li><li data-type='method'><a href="AutomatonWithGUI.html#getParamNames">getParamNames</a></li><li data-type='method'><a href="AutomatonWithGUI.html#pause">pause</a></li><li data-type='method'><a href="AutomatonWithGUI.html#play">play</a></li><li data-type='method'><a href="AutomatonWithGUI.html#redo">redo</a></li><li data-type='method'><a href="AutomatonWithGUI.html#renderAll">renderAll</a></li><li data-type='method'><a href="AutomatonWithGUI.html#save">save</a></li><li data-type='method'><a href="AutomatonWithGUI.html#seek">seek</a></li><li data-type='method'><a href="AutomatonWithGUI.html#setLength">setLength</a></li><li data-type='method'><a href="AutomatonWithGUI.html#togglePlay">togglePlay</a></li><li data-type='method'><a href="AutomatonWithGUI.html#undo">undo</a></li><li data-type='method'><a href="AutomatonWithGUI.html#update">update</a></li></ul></li><li><a href="Clock.html">Clock</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="Clock.html#pause">pause</a></li><li data-type='method'><a href="Clock.html#play">play</a></li><li data-type='method'><a href="Clock.html#setTime">setTime</a></li><li data-type='method'><a href="Clock.html#update">update</a></li></ul></li><li><a href="ClockFrame.html">ClockFrame</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ClockFrame.html#pause">pause</a></li><li data-type='method'><a href="ClockFrame.html#play">play</a></li><li data-type='method'><a href="ClockFrame.html#setTime">setTime</a></li><li data-type='method'><a href="ClockFrame.html#update">update</a></li></ul></li><li><a href="ClockRealtime.html">ClockRealtime</a><ul class='methods'><li class='list-title'>Methods</li><li data-type='method'><a href="ClockRealtime.html#pause">pause</a></li><li data-type='method'><a href="ClockRealtime.html#play">play</a></li><li data-type='method'><a href="ClockRealtime.html#setTime">setTime</a></li><li data-type='method'><a href="ClockRealtime.html#update">update</a></li></ul></li><li><a href="Param.html">Param</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">param.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Interpolator from "./interpolator";

// 🔥 あとでDocs書く

// 🔥 あとでAssignに変える
let cloneObj = ( _obj ) => {
  if ( typeof _obj !== "object" ) { return _obj; }
  let obj = {};
  for ( let key in _obj ) {
    obj[ key ] = _obj[ key ];
  }
  return obj;
}

/**
 * Param of Automaton. 🔥 DOCS: WIP 🔥
 * @param {Automaton} _automaton Parent automaton object
 */
let Param = class {
  constructor( _automaton ) {
    this.automaton = _automaton;

    this.values = [];
    let arrayLength = Math.ceil( this.automaton.data.resolution * this.automaton.data.length ) + 1;
    for ( let i = 0; i &lt; arrayLength; i ++ ) {
      this.values[ i ] = 0.0;
    }
    this.nodes = [];

    this.addNode( 0.0, 0.0 );
    this.addNode( this.automaton.data.length, 0.0 );

    this.currentValue = 0.0;

    this.render();
  }

  load( _data ) {
    let param = this;

    param.nodes = _data;

    param.render();
  }

  sortNodes() {
    let param = this;

    param.nodes.sort( ( a, b ) => a.time - b.time );
  }

  render( _index ) {
    let param = this;

    param.values = [];

    for ( let i = 1; i &lt; param.nodes.length; i ++ ) {
      let startt = param.nodes[ i - 1 ].time;
      let starti = Math.floor( startt * param.automaton.data.resolution );

      let endt = param.nodes[ i ].time;
      let endi = Math.floor( endt * param.automaton.data.resolution );

      let reset = i === 1 || param.nodes[ i ].mods[ Interpolator.MOD_RESET ];
      let resetVel = param.nodes[ i ].mods[ Interpolator.MOD_RESET ] ? param.nodes[ i ].mods[ Interpolator.MOD_RESET ].velocity : 0.0;
      let deltaTime = 1.0 / param.automaton.data.resolution;

      let iparam = {
        mode: param.nodes[ i ].mode,
        start: reset ? param.nodes[ i - 1 ].value : param.values[ starti ],
        end: param.nodes[ i ].value,
        deltaTime: deltaTime,
        length: endi - starti + 1,
        vel: ( !reset &amp;&amp; 2 &lt; param.values.length ) ? ( param.values[ param.values.length - 1 ] - param.values[ param.values.length - 2 ] ) / deltaTime : resetVel,
        mods: param.nodes[ i ].mods
      };
      for ( let key in param.nodes[ i ].params ) {
        iparam[ key ] = param.nodes[ i ].params[ key ];
      }

      let arr = Interpolator.generate( iparam );
      param.values.pop();

      param.values = param.values.concat( arr );
    }
  }

  addNode( _time, _value ) {
    let param = this;

    let next = param.nodes.filter( node => _time &lt; node.time )[ 0 ];
    if ( !next ) {
      next = {
        mode: Interpolator.MODE_LINEAR,
        params: {},
        mods: []
      };
      for ( let i = 0; i &lt; Interpolator.MODS; i ++ ) {
        next.mods[ i ] = false;
      }
    }

    let node = {
      time: _time,
      value: _value,
      mode: next.mode,
      params: cloneObj( next.params ),
      mods: next.mods.map( _obj => cloneObj( _obj ) )
    };
    param.nodes.push( node );

    param.sortNodes();
    param.render();

    return node;
  }

  setTime( _index, _time ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }

    if ( _index !== 0 &amp;&amp; param.nodes.length - 1 !== _index ) {
      param.nodes[ _index ].time = Math.min(
        Math.max(
          _time,
          param.nodes[ _index - 1 ].time + 1.0 / param.automaton.data.resolution
        ),
        param.nodes[ _index + 1 ].time - 1.0 / param.automaton.data.resolution
      );
      param.render();
    }

    return param.nodes[ _index ].time;
  }

  setValue( _index, _value ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }

    param.nodes[ _index ].value = _value;

    param.render();

    return param.nodes[ _index ].value;
  }

  copyProps( _index, _node ) {
    if ( _index &lt; 0 || this.nodes.length &lt;= _index ) { return; }

    let node = this.nodes[ _index ];
    node.mode = _node.mode;
    node.params = cloneObj( _node.params );
    node.mods = _node.mods.map( _obj => cloneObj( _obj ) );

    this.render();
  }

  setMode( _index, _mode ) {
    let param = this;

    if ( _index &lt; 1 || param.nodes.length &lt;= _index ) { return; }

    let node = param.nodes[ _index ];
    node.mode = _mode;
    if ( _mode === Interpolator.MODE_HOLD ) {
      node.params = {};
    } else if ( _mode === Interpolator.MODE_LINEAR ) {
      node.params = {};
    } else if ( _mode === Interpolator.MODE_SMOOTH ) {
      node.params = {};
    } else if ( _mode === Interpolator.MODE_EXP ) {
      node.params = {
        factor: 10.0
      };
    } else if ( _mode === Interpolator.MODE_SPRING ) {
      node.params = {
        rate: 500.0,
        damp: 1.0
      };
    } else if ( _mode === Interpolator.MODE_GRAVITY ) {
      node.params = {
        gravity: 70.0,
        bounce: 0.3
      };
    }

    param.render();
  }

  setParam( _index, _key, _value ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }

    param.nodes[ _index ].params[ _key ] = _value;

    param.render();
  }

  setParams( _index, _params ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }

    for ( let key in _params ) {
      param.nodes[ _index ].params[ key ] = _params[ key ];
    }

    param.render();
  }

  activeModParams( _index, _mod, _active ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }
    if ( _mod &lt; 0 || Interpolator.MODS &lt;= _mod ) { return; }

    if ( _active ) {
      param.nodes[ _index ].mods[ _mod ] = {};

      let params;
      if ( _mod === Interpolator.MOD_RESET ) {
        params = {
          velocity: 0.0
        };
      } else if ( _mod === Interpolator.MOD_SIN ) {
        params = {
          freq: 5.0,
          amp: 0.1,
          phase: 0.0
        };
      } else if ( _mod === Interpolator.MOD_NOISE ) {
        params = {
          freq: 1.0,
          amp: 0.2,
          reso: 8.0,
          recursion: 4.0,
          seed: 1.0
        };
      } else if ( _mod === Interpolator.MOD_LOFI ) {
        params = {
          freq: 10.0
        };
      }
      param.setModParams( _index, _mod, params );
    } else {
      param.nodes[ _index ].mods[ _mod ] = false;
      param.render();
    }
  }

  toggleMod( _index, _mod ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }
    if ( _mod &lt; 0 || Interpolator.MODS &lt;= _mod ) { return; }

    param.activeModParams( _index, _mod, !( param.nodes[ _index ].mods[ _mod ] ) );	
  }

  setModParam( _index, _mod, _key, _value ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }
    if ( _mod &lt; 0 || Interpolator.MODS &lt;= _mod ) { return; }

    param.nodes[ _index ].mods[ _mod ][ _key ] = _value;

    param.render();
  }

  setModParams( _index, _mod, _params ) {
    let param = this;

    if ( _index &lt; 0 || param.nodes.length &lt;= _index ) { return; }
    if ( _mod &lt; 0 || Interpolator.MODS &lt;= _mod ) { return; }

    for ( let key in _params ) {
      param.nodes[ _index ].mods[ _mod ][ key ] = _params[ key ];
    }

    param.render();
  }

  removeNode( _index ) {
    let param = this;

    if ( _index &lt; 1 || param.nodes.length - 1 &lt;= _index ) { return; }

    let node = param.nodes.splice( _index, 1 );

    param.render();

    return node;
  }

  getValue( _time ) {
    let param = this;

    if ( typeof _time !== "number" ) { return param.currentValue; }
    let time = _time;

    if ( time &lt;= 0.0 ) {
      return param.values[ 0 ];
    } else if ( param.automaton.data.length &lt;= time ) {
      return param.values[ param.values.length - 1 ];
    } else {
      let index = time * param.automaton.data.resolution;
      let indexi = Math.floor( index );
      let indexf = index % 1.0;

      let pv = param.values[ indexi ];
      let fv = param.values[ indexi + 1 ];

      let v = pv + ( fv - pv ) * indexf;

      return v;
    }
  }
};

// ------

export default Param;</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc" target="_blank">JSDoc 3.5.5</a> on 4/5/2018 using the <a href="https://github.com/Grafluxe/boxy-jsdoc-template" target="_blank">boxy-jsdoc-template</a> theme.
</footer>

<script src="scripts/prettify/prettify.js"></script>
<script src="scripts/prettify/lang-css.js"></script>
<script src="scripts/script.js"></script>

</body>
</html>
