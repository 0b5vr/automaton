/*! Automaton v2.0.5 - (c) FMS_Cat, MIT License */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Automaton=e():t.Automaton=e()}(this,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e);var s=class{constructor(t){this.automaton=t,this.time=0,this.deltaTime=0,this.isPlaying=!0}update(t){const e=this.time;this.time=t,this.deltaTime=this.time-e}play(){this.isPlaying=!0}pause(){this.isPlaying=!1}setTime(t){this.time=t}};var a=class extends s{constructor(t,e){super(t),this.frame=0,this.fps=e}update(){this.isPlaying?(this.time=this.frame/this.fps,this.deltaTime=1/this.fps,this.frame++):this.deltaTime=0}setTime(t){this.frame=Math.floor(this.fps*t),this.time=this.frame/this.fps}};var o=class extends s{constructor(t){super(t),this.realtime=!0,this.rtTime=0,this.rtDate=+new Date}update(){if(this.isPlaying){const t=this.time,e=Date.now()-this.rtDate;this.time=this.rtTime+e/1e3,this.deltaTime=this.time-t}else this.rtTime=this.time,this.rtDate=+new Date,this.deltaTime=0}setTime(t){this.time=t,this.rtTime=this.time,this.rtDate=+new Date}};let r=[];const n=(t,e)=>1-3*e+3*t,l=(t,e)=>3*e-6*t,h=t=>3*t,_=t=>Math.min(Math.max(t,0),1),u=(t,e,i)=>((n(e,i)*t+l(e,i))*t+h(e))*t,m=(t,e,i)=>3*n(e,i)*t*t+2*l(e,i)*t+h(e),c=(t,e,i,s,a)=>{if(isNaN(t)||isNaN(e)||isNaN(i)||isNaN(s))return a;if(t===e&&i===s)return a;if(a<=0)return 0;if(1<=a)return 1;t=_(t),i=_(i);for(let e=0;e<21;e++)r[e]=u(e/20,t,i);let o=1;for(let t=1;t<21&&(o=t-1,!(a<r[t]));t++);let n=(o+(a-r[o])/(r[o+1]-r[o]))/20;const l=m(n,t,i);return.001<=l?n=((t,e,i,s)=>{for(let a=0;a<4;a++){const a=m(e,i,s);if(0===a)return e;e-=(u(e,i,s)-t)/a}return e})(a,n,t,i):0!==l&&(n=((t,e,i,s,a)=>{let o=0,r=0;for(let n=0;n<10&&(0<(o=u(r=e+(i-e)/2,s,a)-t)?i=r:e=r,!(1e-6<Math.abs(o)));n++);return r})(a,o/20,(o+1)/20,t,i)),u(n,e,s)};var f=(t,e,i)=>{const s=e.time-t.time,a=e.value-t.value,o=t.out.time/s,r=t.out.value/a,n=(e.time+e.in.time-t.time)/s,l=(e.value+e.in.value-t.value)/a,h=(i-t.time)/s;return t.value+c(o,r,n,l,h)*a};var p=class{constructor(t){this.__automaton=t.automaton,this.__values=new Float32Array(this.__automaton.resolution*this.__automaton.length+1),this.load(t.data),this.__lastValue=0,this.__lastTime=0}load(t){this.__nodes=t.nodes,this.__fxs=t.fxs,this.precalc()}precalc(){for(let t=0;t<this.__nodes.length-1;t++){const e=this.__nodes[t],i=this.__nodes[t+1],s=Math.floor(e.time*this.__automaton.resolution),a=Math.floor(i.time*this.__automaton.resolution);this.__values[s]=e.value;for(let t=s+1;t<=a;t++){const s=t/this.__automaton.resolution,a=f(e,i,s);this.__values[t]=a}}for(let t=0;t<this.__fxs.length;t++){const e=this.__fxs[t];if(e.bypass)continue;const i=this.__automaton.__paramFxDefs[e.def];if(!i)continue;const s=Math.ceil(this.__automaton.resolution*e.time),a=Math.floor(this.__automaton.resolution*(e.time+e.length)),o=new Float32Array(a-s),r=o.length;let n={i0:s,i1:a,t0:e.time,t1:e.time+e.length,deltaTime:1/this.__automaton.resolution,dt:1/this.__automaton.resolution,resolution:this.__automaton.resolution,length:e.length,params:e.params,array:this.__values,getValue:this.getValue.bind(this),init:!0};for(let t=0;t<r;t++)n.i=n.index=t+s,n.t=n.time=n.i/this.__automaton.resolution,n.v=n.value=this.__values[t+s],n.p=n.progress=(n.t-e.time)/e.length,o[t]=i.func(n),n.init=!1;this.__values.set(o,s)}}getValue(t){let e=t;if("number"!=typeof e&&(e=this.__automaton.time),e===this.__lastTime)return this.__lastValue;if(this.__automaton.loop&&(e-=Math.floor(e/this.__automaton.length)*this.__automaton.length),e<=0)return this.__values[0];if(this.__automaton.length<=e)return this.__values[this.__values.length-1];{const t=e*this.__automaton.resolution,i=Math.floor(t),s=t%1,a=this.__values[i],o=a+(this.__values[i+1]-a)*s;return this.__lastTime=e,this.__lastValue=o,o}}};var d=class{constructor(t){this.__version="2.0.5",this.loop=t.loop||!1,this.__clock=t.fps?new a(this,t.fps):t.realtime?new o(this):new s(this),this.__listeners={},this.__paramFxDefs={};const e=t.data;this.load(e),this.auto=(t=>this.__auto(t))}get version(){return this.__version}get time(){return this.__clock.time}get length(){return this.__length}get resolution(){return this.__resolution}get deltaTime(){return this.__clock.deltaTime}get isPlaying(){return this.__clock.isPlaying}get progress(){return this.time/this.length}get frame(){return this.__clock.frame?this.__clock.frame:void 0}get fps(){return this.__clock.fps?this.__clock.fps:void 0}get realtime(){return Boolean(this.__clock.realtime)}createParam(t,e){this.__params[t]=new p({automaton:this,data:e})}load(t){this.__length=t.length,this.__resolution=t.resolution,this.__params={};for(const e in t.params)this.createParam(e,t.params[e])}seek(t){this.__clock.setTime(t),this.__emit("seek")}play(){this.__clock.play(),this.__emit("play")}pause(){this.__clock.pause(),this.__emit("pause")}addFxDefinition(t,e){this.__paramFxDefs[t]=e,this.precalcAll()}__emit(t,...e){this.__listeners[t]&&this.__listeners[t].map(t=>t(...e))}on(t,e){this.__listeners[t]||(this.__listeners[t]=[]),this.__listeners[t].push(e)}precalcAll(){for(const t in this.__params)this.__params[t].precalc()}update(t){this.__clock.update(t),this.loop&&(this.time<0||this.length<this.time)&&this.__clock.setTime(this.time-Math.floor(this.time/this.length)*this.length);for(let t in this.__params)this.__params[t].getValue()}__auto(t){return this.__params[t].getValue()}};e.default=d}]).default});