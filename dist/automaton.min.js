!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.Automaton=e()}}(function(){return function e(t,n,i){function a(r,l){if(!n[r]){if(!t[r]){var s="function"==typeof require&&require;if(!l&&s)return s(r,!0);if(o)return o(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[r]={exports:{}};t[r][0].call(d.exports,function(e){var n=t[r][1][e];return a(n?n:e)},d,d.exports,e,t,n,i)}return n[r].exports}for(var o="function"==typeof require&&require,r=0;r<i.length;r++)a(i[r]);return a}({"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/colors.js":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=function(){var e={accent:"#2af",bar:"#f82"};return e};n.default=i},{}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/gui.js":[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./colors"),r=i(o),l=e("./images"),s=i(l),u=e("./interpolator"),d=i(u),m=void 0,c=void 0,f=function(e,t,n,i){var a=n-e,o=i-t;return Math.sqrt(a*a+o*o)},p=function(e,t,n){var i=null;i="string"==typeof e?document.createElement(e):e;for(var a in t)i.style[a]=t[a];return n&&n.appendChild(i),i},v=function(){var e={},t="",n=0,i=0;e.el=p("div",{position:"fixed",padding:"2px",pointerEvents:"none",font:"200 12px Helvetica Neue, sans-serif",background:"#000",color:"#fff",opacity:"0.0"}),window.addEventListener("mousemove",function(e){n=e.clientX,i=e.clientY}),e.add=function(n,i,a){var o=!1,r=0,l=0,s="number"==typeof a?a:1,u=function(n){if(l++,1===l){o=!0,r++;var a=r;t=i,setTimeout(function(){o&&r===a&&p(e.el,{opacity:"0.8"})},1e3*s)}};n.addEventListener("mouseenter",u);var d=function(t){l--,0===l&&(o=!1,p(e.el,{opacity:"0.0"}))};n.addEventListener("mouseleave",d);var m=function(t){o=!1,p(e.el,{opacity:"0.0"})};return n.addEventListener("mousedown",m),function(){n.removeEventListener("mouseenter",u),n.removeEventListener("mouseleave",d)}};var a=function a(){"function"==typeof t?e.el.innerText=t():e.el.innerText=t;var o=e.el.clientWidth,r=window.innerWidth-n<o+10,l={left:n+(r?-o-10:10)+"px",top:i-15+"px"};p(e.el,l),requestAnimationFrame(a)};return a(),e},h=function(e){var t={};t.automaton=e,m=(0,r.default)(),c=(0,s.default)(),t.inspector=v();var n=240;t.parent=p("div",{position:"fixed",left:"0",bottom:"0",width:"100%",height:n+"px",background:"#222",color:"#ddd",userSelect:"none",font:"300 14px Helvetica Neue, sans-serif"},document.body);var i=30;t.header=p("div",{position:"absolute",left:"0",top:"0",width:"100%",height:i+"px",background:"#444"},t.parent),t.headerTitle=p("div",{position:"absolute",left:"6px",top:"0px",font:"500 24px Century Gothic, sans-serif",letterSpacing:"8px",color:"#ddd"},t.header),t.headerTitle.innerHTML='AUT<span style="color:'+m.accent+'">O</span>MAT<span style="color:'+m.accent+'">O</span>N',t.headerButtonContainer=p("div",{position:"absolute",right:"4px"},t.header);var o=function(e,n,i){var a=p("img",{width:"24px",height:"24px",margin:"3px",cursor:"pointer"},t.headerButtonContainer);a.src=e,t.inspector.add(a,n,.5),a.addEventListener("click",function(e){1===e.which&&i()})};o(c.beatsnap,"Beat Snap",function(){t.beatSnapDialog()}),o(c.config,"Config",function(){t.config()}),o(c.save,"Save",function(){t.save()});var l=120;t.paramList=p("div",{position:"absolute",left:"0",top:i+"px",width:l+"px",height:"calc( 100% - "+i+"px )",background:"#111",overflow:"hidden"},t.parent),t.paramListChildren=[],t.currentParamIndex=-1,t.currentParamName="",t.currentParam=null,t.paramListInside=p("div",{position:"absolute",top:"0px",width:"100%"},t.paramList);var u=0;t.paramListInside.addEventListener("wheel",function(e){e.preventDefault(),u=Math.max(Math.min(u+e.deltaY,t.paramListInside.clientHeight-(n-i)),0),p(t.paramListInside,{top:-u+"px"})});var h=200;t.modMenu=p("div",{position:"absolute",right:"0",top:i+"px",width:h+"px",height:"100%",background:"#333",overflow:"hidden"},t.parent),t.modMenuInside=p("div",{position:"absolute",top:"0px",width:"calc( 100% - 20px )",padding:"20px 10px"},t.modMenu);var g=0;t.modMenuInside.addEventListener("wheel",function(e){e.preventDefault(),g=Math.max(Math.min(g+e.deltaY,t.modMenuInside.clientHeight-(n-i)),0),p(t.modMenuInside,{top:-g+"px"})}),t.timeline=p("div",{position:"absolute",left:l+"px",top:i+"px",width:"calc( 100% - "+(l+h)+"px )",height:"calc( 100% - "+i+"px )",background:"#222",overflow:"hidden"},t.parent),t.timelineCanvas=p("canvas",{position:"absolute",width:"100%",height:"100%"},t.timeline),t.timelineContext=t.timelineCanvas.getContext("2d"),t.dialogContainer=p("div",{position:"absolute",display:"none",width:"100%",height:"100%"},t.parent),t.dialogBackground=p("div",{position:"absolute",width:"100%",height:"100%",background:"#000",opacity:.5},t.dialogContainer),t.dialog=p("div",{position:"absolute",background:"#333"},t.dialogContainer),t.dialogContent=p("div",{position:"absolute",top:"16px",width:"100%",height:"24px",textAlign:"center",whiteSpace:"pre-wrap"},t.dialog),t.dialogButtonContainer=p("div",{position:"absolute",bottom:"16px",width:"100%",height:"24px",textAlign:"center"},t.dialog),t.addDialogButton=function(e,n){var i=p("div",{display:"inline-block",width:"60px",height:"16px",padding:"4px",margin:"0 5px",textAlign:"center",background:"#555",cursor:"pointer"},t.dialogButtonContainer);i.innerText=e,i.addEventListener("click",function(e){1===e.which&&n()})},t.showDialog=function(e,n){p(t.dialogContainer,{display:"block"}),p(t.dialog,a({left:"calc( 50% - "+e/2+"px )",top:"calc( 50% - "+n/2+"px )",height:"",width:e+"px"},"height",n+"px"))},t.hideDialog=function(){for(p(t.dialogContainer,{display:"none"});t.dialogContent.firstChild;)t.dialogContent.removeChild(t.dialogContent.firstChild);for(;t.dialogButtonContainer.firstChild;)t.dialogButtonContainer.removeChild(t.dialogButtonContainer.firstChild)},window.addEventListener("keydown",function(e){27===e.which&&t.hideDialog()}),t.beatSnap=!1,t.beatSnapOffset=0,t.beatSnapBpm=140,t.beatSnapDialog=function(){var e=function(e,i){var a=p("div",{position:"relative",width:"160px",height:"20px",margin:"0 20px 10px 20px"},t.dialogContent),o=p("div",{position:"absolute",left:"0",top:"3px"},a);o.innerText=e;var r=p("input",{position:"absolute",right:"0",padding:"4px",width:"60px",border:"none",background:"#666",color:"#fff",textAlign:"center"},a);return"number"==typeof i?(r.value=i,r.addEventListener("keydown",function(e){13===e.which&&(e.preventDefault(),n())})):(p(r,{top:"3px"}),r.type="checkbox",r.checked=i),{parent:a,label:o,input:r}},n=function(){t.hideDialog(),t.beatSnap=i.input.checked;var e=parseFloat(a.input.value);isNaN(e)||(t.beatSnapBpm=e);var n=parseFloat(o.input.value);isNaN(n)||(t.beatSnapOffset=n)},i=e("BeatSnap",t.beatSnap),a=e("BPM",t.beatSnapBpm),o=e("Offset",t.beatSnapOffset);t.addDialogButton("OK",n),t.addDialogButton("Cancel",function(){t.hideDialog()}),t.showDialog(200,150)},t.configLength=function(e){t.automaton.length=e;for(var n in t.automaton.params){for(var i=t.automaton.params[n],a=i.nodes.length-1;0<a;a--){var o=i.nodes[a];e<o.time&&i.nodes.splice(a,1)}var r=i.nodes[i.nodes.length-1];r.time!==e&&i.addNode(e,0)}},t.configConfirm=function(e){var n=p("div",{},t.dialogContent);n.innerText="Shortening length may cause loss of node data.\nContinue?",t.addDialogButton("Shorten",function(){t.configLength(e),t.hideDialog()}),t.addDialogButton("Cancel",function(){t.hideDialog()}),t.showDialog(400,100)},t.config=function(){var e=function(e,i){var a=p("div",{position:"relative",width:"160px",height:"20px",margin:"0 20px 10px 20px"},t.dialogContent),o=p("div",{position:"absolute",left:"0",top:"3px"},a);o.innerText=e;var r=p("input",{position:"absolute",right:"0",padding:"4px",width:"60px",border:"none",background:"#666",color:"#fff",textAlign:"center"},a);return r.value=i,r.addEventListener("keydown",function(e){13===e.which&&(e.preventDefault(),n())}),{parent:a,label:o,input:r}},n=function(){t.hideDialog();var e=parseFloat(i.input.value);isNaN(e)||(e<t.automaton.length?t.configConfirm(e):t.configLength(e));var n=parseInt(a.input.value);isNaN(n)||(t.automaton.resolution=n),t.automaton.renderAll()},i=e("Length",t.automaton.length),a=e("Resolution",t.automaton.resolution);t.addDialogButton("OK",n),t.addDialogButton("Cancel",function(){t.hideDialog()}),t.showDialog(200,120)},t.save=function(){var e=t.automaton.save(),n=p("div",{},t.dialogContent);n.innerText="Copy the JSON below";var i=p("input",{margin:"10px",padding:"4px",width:"100px",border:"none",background:"#666",color:"#fff"},t.dialogContent);i.value=JSON.stringify(e),i.readOnly=!0,t.addDialogButton("OK",function(){t.hideDialog()}),t.showDialog(200,120),i.select()},t.addParam=function(e,n){var i=p("div",{margin:"2px",padding:"2px 8px",width:"calc( 100% - 4px - 16px )",height:"20px",fontSize:"14px",background:"#333",cursor:"pointer"},t.paramListInside);i.innerText=e,i.addEventListener("mousedown",function(e){1===e.which&&(t.selectParam(n),t.updateTimeline(!0))});var a=t.automaton.params[e];t.inspector.add(i,function(){return a.getValue().toFixed(3)},.5),t.paramListChildren.push(i)},t.clearParamList=function(){for(;t.paramListInside.firstChild;)t.paramListInside.removeChild(t.paramListInside.firstChild);t.paramListChildren=[]},t.updateParamList=function(){t.clearParamList();var e=t.automaton.getParamNames();e.map(function(e,n){t.addParam(e,n)}),t.selectParam(t.currentParamIndex)},t.timelineMinV=0,t.timelineMaxV=1,t.timelineMinT=0,t.timelineMaxT=1,t.canvasWidth=0,t.canvasHeight=0,t.mapTime=function(e){return t.canvasWidth*(e-t.timelineMinT)/(t.timelineMaxT-t.timelineMinT)},t.mapValue=function(e){return t.canvasHeight*(t.timelineMaxV-e)/(t.timelineMaxV-t.timelineMinV)},t.rmapTime=function(e){return t.timelineMinT+e/t.canvasWidth*(t.timelineMaxT-t.timelineMinT)},t.rmapValue=function(e){return-e/t.canvasHeight*(t.timelineMaxV-t.timelineMinV)+t.timelineMaxV},t.timelineNodeRadius=4,t.timelineNodeRadiusGrab=8,t.selectedTimelineNode=-1,t.selectTimelineNode=function(e){t.selectedTimelineNode=e,t.resetModMenu()},t.grabbingTimelineNode=-1,t.grabTimelineNode=function(e){t.grabbingTimelineNode=e,t.selectTimelineNode(e)};var x=0;return t.timelineCanvas.addEventListener("mousedown",function(e){var n=t.currentParam;if(n){var i=t.timeline.getBoundingClientRect(),a=+new Date;if(a-x<500){var o=!1;if(n.nodes.map(function(a,r){var l=t.mapTime(a.time),s=t.mapValue(a.value);f(l,s,e.clientX-i.left,e.clientY-i.top)<t.timelineNodeRadiusGrab&&(n.removeNode(r),t.selectTimelineNode(-1),o=!0)}),o)return;var r=n.addNode(t.rmapTime(e.clientX-i.left),t.rmapValue(e.clientY-i.top));t.grabTimelineNode(n.nodes.indexOf(r))}else n.nodes.map(function(n,a){var o=t.mapTime(n.time),r=t.mapValue(n.value);f(o,r,e.clientX-i.left,e.clientY-i.top)<t.timelineNodeRadiusGrab&&t.grabTimelineNode(a)});x=a}}),window.addEventListener("mousemove",function(e){if(t.grabbingTimelineNode!==-1){var n=t.currentParam,i=(n.nodes[t.grabbingTimelineNode],t.timeline.getBoundingClientRect()),a=e.clientX-i.left,o=t.rmapTime(a);if(t.beatSnap){var r=60/t.beatSnapBpm,l=t.timelineMaxT-t.timelineMinT,s=Math.log(l/r)/Math.log(4),u=Math.pow(4,Math.floor(s-.5))*r,d=Math.round(o/u)*u+t.beatSnapOffset;Math.abs(a-t.mapTime(d))<t.timelineNodeRadiusGrab&&(o=d)}n.setTime(t.grabbingTimelineNode,o),n.setValue(t.grabbingTimelineNode,t.rmapValue(e.clientY-i.top)),t.updateModMenu()}}),window.addEventListener("mouseup",function(e){t.grabbingTimelineNode!==-1&&(t.grabbingTimelineNode=-1)}),t.timelineCanvas.addEventListener("wheel",function(e){e.preventDefault();var n=t.timeline.getBoundingClientRect();if(e.shiftKey){var i=t.rmapTime(e.clientX-n.left);t.timelineMinT+=.005*(i-t.timelineMinT)*e.deltaY,t.timelineMaxT-=.005*(t.timelineMaxT-i)*e.deltaY;var a=t.timelineMinT<0,o=t.automaton.length<t.timelineMaxT;a?o?(t.timelineMinT=0,t.timelineMaxT=t.automaton.length):(t.timelineMaxT+=0-t.timelineMinT,t.timelineMinT+=0-t.timelineMinT):o&&(t.timelineMinT+=t.automaton.length-t.timelineMaxT,t.timelineMaxT+=t.automaton.length-t.timelineMaxT)}else if(e.altKey){var r=t.rmapValue(e.clientY-n.top);t.timelineMinV+=.005*(r-t.timelineMinV)*e.deltaY,t.timelineMaxV-=.005*(t.timelineMaxV-r)*e.deltaY}else{var l=t.timelineMaxT-t.timelineMinT,s=t.timelineMaxV-t.timelineMinV;t.timelineMinT+=e.deltaX*l/t.canvasWidth,t.timelineMaxT+=e.deltaX*l/t.canvasWidth,t.timelineMinT<0&&(t.timelineMaxT+=0-t.timelineMinT,t.timelineMinT+=0-t.timelineMinT),t.automaton.length<t.timelineMaxT&&(t.timelineMinT+=t.automaton.length-t.timelineMaxT,t.timelineMaxT+=t.automaton.length-t.timelineMaxT),t.timelineMinV-=e.deltaY*s/t.canvasHeight,t.timelineMaxV-=e.deltaY*s/t.canvasHeight}}),t.resetTimelineRange=function(){var e=t.currentParam;e&&(t.timelineMinV=0,t.timelineMaxV=0,e.nodes.map(function(e){t.timelineMinV=Math.min(t.timelineMinV,e.value),t.timelineMaxV=Math.max(t.timelineMaxV,e.value)}),t.timelineMinV===t.timelineMaxV&&(t.timelineMinV-=.5,t.timelineMaxV+=.5))},t.updateTimelineCanvas=function(e){t.timelineContext.clearRect(0,0,t.canvasWidth,t.canvasHeight);for(var n=t.timelineMaxV-t.timelineMinV,i=Math.log10(n),a=Math.pow(10,Math.floor(i)-1),o=i-Math.floor(i),r=Math.floor(t.timelineMinV/a),l=r*a,s=r-10*Math.floor(r/10),u=r-100*Math.floor(r/100),d=l;d<t.timelineMaxV;d+=a)t.timelineContext.globalAlpha=0===u?.4:0===s?.4-.3*o:.1-.1*o,t.timelineContext.fillStyle="#fff",t.timelineContext.fillRect(0,t.mapValue(d)-.5,t.canvasWidth,1),s=(s+1)%10,u=(u+1)%100;t.timelineContext.globalAlpha=1;for(var c=t.timelineMaxT-t.timelineMinT,f=Math.log10(c),p=Math.pow(10,Math.floor(f)-1),v=f-Math.floor(f),h=Math.floor(t.timelineMinT/p),g=h*p,x=h-10*Math.floor(h/10),M=h-100*Math.floor(h/100),T=g;T<t.timelineMaxT;T+=p)t.timelineContext.globalAlpha=0===M?.4:0===x?.4-.3*v:.1-.1*v,t.timelineContext.fillStyle="#fff",t.timelineContext.fillRect(t.mapTime(T)-.5,0,1,t.canvasHeight),x=(x+1)%10,M=(M+1)%100;if(t.timelineContext.globalAlpha=1,t.beatSnap){var b=60/t.beatSnapBpm,y=t.timelineMaxT-t.timelineMinT,S=Math.log(y/b)/Math.log(4),C=Math.pow(4,Math.floor(S-.5))*b,D=Math.floor(t.timelineMinT/C)*C+t.beatSnapOffset%C;t.timelineContext.font="400 10px Helvetica Neue, sans-serif";for(var O=D;O<t.timelineMaxT;O+=C)t.timelineContext.globalAlpha=.6,t.timelineContext.fillStyle=m.accent,t.timelineContext.fillRect(t.mapTime(O)-.5,0,1,t.canvasHeight),t.timelineContext.fillText(((O-t.beatSnapOffset)/b).toFixed(2),t.mapTime(O)+2,t.canvasHeight-2);t.timelineContext.globalAlpha=1}t.timelineContext.beginPath(),t.timelineContext.moveTo(0,t.mapValue(e.getValue(t.rmapTime(0))));for(var w=1;w<t.timelineCanvas.width;w++){var N=t.rmapTime(w),P=t.mapValue(e.getValue(N));t.timelineContext.lineTo(w,P)}t.timelineContext.strokeStyle="#ddd",t.timelineContext.lineWidth=2,t.timelineContext.lineCap="round",t.timelineContext.lineJoin="round",t.timelineContext.stroke();var E=t.mapTime(t.automaton.time),k=t.mapValue(t.currentParam.getValue(t.automaton.time));t.timelineContext.fillStyle=m.accent,t.timelineContext.fillRect(E-1,0,2,t.canvasHeight),t.timelineContext.beginPath(),t.timelineContext.arc(E,k,4,0,2*Math.PI,!1),t.timelineContext.fill(),e.nodes.map(function(e,n){var i=t.mapTime(e.time),a=t.mapValue(e.value);t.timelineContext.beginPath(),a<-t.timelineNodeRadius?(t.timelineContext.moveTo(i,5),t.timelineContext.lineTo(i-t.timelineNodeRadius,5+1.7*t.timelineNodeRadius),t.timelineContext.lineTo(i+t.timelineNodeRadius,5+1.7*t.timelineNodeRadius),t.timelineContext.closePath()):t.canvasHeight+t.timelineNodeRadius<a?(t.timelineContext.moveTo(i,t.canvasHeight-5),t.timelineContext.lineTo(i-t.timelineNodeRadius,t.canvasHeight-5-1.7*t.timelineNodeRadius),t.timelineContext.lineTo(i+t.timelineNodeRadius,t.canvasHeight-5-1.7*t.timelineNodeRadius),t.timelineContext.closePath()):t.timelineContext.arc(i,a,t.timelineNodeRadius,0,2*Math.PI,!1),t.selectedTimelineNode===n?(t.timelineContext.fillStyle=m.accent,t.timelineContext.strokeStyle=m.accent,t.timelineContext.lineWidth=4,t.timelineContext.stroke(),t.timelineContext.fill()):(t.timelineContext.fillStyle="#222",t.timelineContext.strokeStyle=m.accent,t.timelineContext.lineWidth=4,t.timelineContext.stroke(),t.timelineContext.fill())})},t.updateTimeline=function(){t.canvasWidth=window.innerWidth-l-h,t.canvasHeight=n-i,t.timelineCanvas.width=t.canvasWidth,t.timelineCanvas.height=t.canvasHeight;var e=t.currentParam;e&&t.updateTimelineCanvas(e)},t.paramBoxListeners=[],t.resetModMenu=function(){var e=t.currentParam;if(e){for(;t.modMenuInside.firstChild;)t.modMenuInside.removeChild(t.modMenuInside.firstChild);t.paramBoxListeners=[];var n=e.nodes[t.selectedTimelineNode];if(n){var i=function(){p("div",{width:"170px",height:"1px",margin:"0 5px 5px 5px",background:"#666"},t.modMenuInside)},a=function(n,i,a,o){var r=function(e){var t=parseFloat(e);t=isNaN(t)?0:t,d.innerText=t.toFixed(3),c.value=t,"function"==typeof a&&(a(t),t=i(),d.innerText=t.toFixed(3),c.value=t)},l=p("div",{position:"relative",margin:"0 0 5px 0",width:"100%",height:"14px",fontSize:"12px"},o),s=p("div",{position:"absolute",left:"20px",top:"0",width:"50px",height:"100%"},l);s.innerText=n;var u=p("div",{position:"absolute",right:"10px",top:"0",width:"60px",height:"100%"},l),d=p("div",{position:"absolute",left:"0",top:"0",width:"100%",height:"100%",textAlign:"center",cursor:"pointer"},u),m=0;d.addEventListener("mousedown",function(e){var t=+new Date;t-m<500?(p(c,{display:"block"}),setTimeout(function(){return c.focus()},10)):!function(){var t=e.clientY,n=function(e){var n=parseFloat(d.innerText),i=e.clientY,a=t-i;if(t=i,e.shiftKey){for(var o=Math.abs(a),l=Math.sign(a),s=0;s<o;s++){var u=Math.abs(n),m=Math.sign(n+1e-4*l),c=Math.floor(Math.log10(u+1e-4*l*m))-1-(e.altKey?1:0),f=Math.max(.001,Math.pow(10,c))*l;n=parseFloat((n+f).toFixed(3))}r(n)}else{var p=e.altKey?.001:.01;r((n+a*p).toFixed(3))}},i=function e(t){window.removeEventListener("mousemove",n),window.removeEventListener("mouseup",e)};window.addEventListener("mousemove",n),window.addEventListener("mouseup",i)}(),m=t});var c=p("input",{position:"absolute",display:"none",left:"0",top:"0",width:"100%",height:"100%",border:"none",padding:"0",background:"#666",color:"#fff",textAlign:"center"},u);return c.addEventListener("keydown",function(e){13===e.which&&(e.preventDefault(),r(c.value),p(c,{display:"none"}))}),c.addEventListener("blur",function(){r(c.value),p(c,{display:"none"})}),r(i()),t.paramBoxListeners.push(function(){var e=i();d.innerText=e.toFixed(3),c.value=e}),e};a("time",function(){return n.time},function(n){return e.setTime(t.selectedTimelineNode,n)},t.modMenuInside),a("value",function(){return n.value},function(n){return e.setValue(t.selectedTimelineNode,n)},t.modMenuInside),i();for(var o=p("div",{margin:"5px 5px 0 5px",width:"180px"},t.modMenuInside),r=n.mode,l=[],s=function(n){var i=p("img",{width:"30px",height:"30px",margin:"2px",cursor:"pointer",filter:n===r?"":"grayscale( 90% )"},o);l.push(i),i.src=c.modes[n],i.addEventListener("mousedown",function(i){e.setMode(t.selectedTimelineNode,n),t.resetModMenu()}),t.inspector.add(i,d.default.modeNames[n],.5)},u=0;u<d.default.MODES;u++)s(u);var m=function(i){a(i,function(){return n.params[i]},function(n){var a={};a[i]=n,e.setParams(t.selectedTimelineNode,a)},t.modMenuInside)};for(var f in n.params)m(f);i();for(var v=function(i){var o=p("div",{position:"relative",margin:"10px 0 20px 0",width:"100%",minHeight:"24px"},t.modMenuInside),r=p("img",{position:"absolute",width:"24px",height:"24px",left:"10px",cursor:"pointer",filter:n.mods[i]?"":"grayscale( 90% )"},o);if(r.src=c.mods[i],r.addEventListener("mousedown",function(a){e.activeModParams(t.selectedTimelineNode,i,!n.mods[i]),t.resetModMenu()}),t.inspector.add(r,d.default.modNames[i],.5),n.mods[i]){var l=p("div",{position:"relative",left:"30px",width:"calc( 100% - 30px )"},o),s=function(o){a(o,function(){return n.mods[i][o]},function(n){var a={};a[o]=n,e.setModParams(t.selectedTimelineNode,i,a)},l)};for(var u in n.mods[i])s(u)}},h=0;h<d.default.MODS;h++)v(h)}}},t.updateModMenu=function(){t.paramBoxListeners.map(function(e){e()})},t.selectParam=function(e){e<0||t.paramListChildren.length<=e||(t.currentParam&&p(t.paramListChildren[t.currentParamIndex],{background:"#333"}),t.currentParamIndex=e,t.currentParamName=t.paramListChildren[t.currentParamIndex].innerText,t.currentParam=t.automaton.params[t.currentParamName],p(t.paramListChildren[t.currentParamIndex],{background:"#555"}),t.selectTimelineNode(-1))},p(t.inspector.el,{},document.body),t.update=function(){t.updateTimeline(),t.paramListChildren.length!==t.automaton.countParams()&&t.updateParamList()},t.resize=function(){t.updateTimeline()},window.addEventListener("resize",t.resize),t.getState=function(){var e={beatSnap:t.beatSnap,beatSnapBpm:t.beatSnapBpm,beatSnapOffset:t.beatSnapOffset,timelineMinT:t.timelineMinT,timelineMaxT:t.timelineMaxT,timelineMinV:t.timelineMinV,timelineMaxV:t.timelineMaxV};return e},t.setState=function(e){var n=function(e,t){return"undefined"!=typeof e?e:t};t.beatSnap=n(e.beatSnap,!1),t.beatSnapBpm=n(e.beatSnapBpm,140),t.beatSnapOffset=n(e.beatSnapOffset,0),t.timelineMinT=n(e.timelineMinT,0),t.timelineMaxT=n(e.timelineMaxT,1),t.timelineMinV=n(e.timelineMinV,0),t.timelineMaxV=n(e.timelineMaxV,1)},t.updateParamList(),t.selectParam(0),t};n.default=h},{"./colors":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/colors.js","./images":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/images.js","./interpolator":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/interpolator.js"}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/images.js":[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./interpolator"),o=i(a),r=e("./colors"),l=i(r),s=void 0,u=function(){var e={};s=(0,l.default)();var t=document.createElement("canvas"),n=t.width=t.height=128,i=t.getContext("2d");i.lineCap="round",i.lineJoin="round";var a=function(e){return i.save(),i.clearRect(0,0,n,n),e(),i.restore(),t.toDataURL()};e.modes=[];for(var r=function(t){e.modes[t]=a(function(){i.beginPath(),i.moveTo(n/8,n/8*7);for(var e=o.default.generate({mode:t}),a=1;a<e.length;a++)i.lineTo(n/8+n/4*3*a/e.length,n/8*7-n/4*3*e[a]);i.strokeStyle=s.accent,i.lineWidth=n/12,i.stroke()})},u=0;u<o.default.MODES;u++)r(u);return e.mods=[],e.mods[o.default.MOD_RESET]=a(function(){i.beginPath(),i.arc(n/2,n/2,n/3,-Math.PI/4,Math.PI/4*5,!1),i.moveTo(n/2,n/2),i.lineTo(n/2,n/8),i.strokeStyle=s.accent,i.lineWidth=n/12,i.stroke()}),e.mods[o.default.MOD_SIN]=a(function(){i.beginPath(),i.moveTo(n/8,n/2);for(var e=o.default.generate({mode:o.default.MODE_LINEAR,start:.5,end:.5,mods:[!1,{}]}),t=1;t<e.length;t++)i.lineTo(n/8+n/4*3*t/e.length,n/8*7-n/4*3*e[t]);i.strokeStyle=s.accent,i.lineWidth=n/12,i.stroke()}),e.mods[o.default.MOD_NOISE]=a(function(){i.beginPath(),i.moveTo(n/8,n/2);for(var e=o.default.generate({mode:o.default.MODE_LINEAR,start:.5,end:.5,mods:[!1,!1,{}]}),t=1;t<e.length;t++)i.lineTo(n/8+n/4*3*t/e.length,n/8*7-n/4*3*e[t]);i.strokeStyle=s.accent,i.lineWidth=n/12,i.stroke()}),e.mods[o.default.MOD_LOFI]=a(function(){i.beginPath(),i.moveTo(n/8,n/8*7);for(var e=o.default.generate({mode:o.default.MODE_LINEAR,start:0,end:1,mods:[!1,!1,!1,{}]}),t=1;t<e.length;t++)i.lineTo(n/8+n/4*3*t/e.length,n/8*7-n/4*3*e[t]);i.strokeStyle=s.accent,i.lineWidth=n/12,i.stroke()}),e.save=a(function(){i.beginPath(),i.moveTo(n/8,n/8),i.lineTo(n/8,n/8*7),i.lineTo(n/8*7,n/8*7),i.lineTo(n/8*7,n/4),i.lineTo(n/4*3,n/8),i.closePath(),i.moveTo(n/4,n/2),i.lineTo(n/4*3,n/2),i.lineTo(n/4*3,n/6*5),i.lineTo(n/4,n/6*5),i.closePath(),i.moveTo(n/4,n/6),i.lineTo(n/3*2,n/6),i.lineTo(n/3*2,n/8*3),i.lineTo(n/4,n/8*3),i.closePath(),i.moveTo(n/2,n/5),i.lineTo(n/8*5,n/5),i.lineTo(n/8*5,n/3),i.lineTo(n/2,n/3),i.closePath(),i.fillStyle=s.accent,i.fill()}),e.beatsnap=a(function(){i.beginPath(),i.moveTo(n/8,n/4*3),i.lineTo(n/8,n/8*7),i.lineTo(n/8*3,n/8*7),i.lineTo(n/8*3,n/4*3),i.closePath(),i.moveTo(n/8*5,n/4*3),i.lineTo(n/8*5,n/8*7),i.lineTo(n/8*7,n/8*7),i.lineTo(n/8*7,n/4*3),i.closePath(),i.fillStyle=s.accent,i.fill(),i.beginPath(),i.moveTo(n/8,n/16*11),i.lineTo(n/8,n/2),i.arc(n/2,n/2,n/8*3,Math.PI,0,!1),i.lineTo(n/8*7,n/16*11),i.lineTo(n/8*5,n/16*11),i.lineTo(n/8*5,n/2),i.arc(n/2,n/2,n/8,0,Math.PI,!0),i.lineTo(n/8*3,n/16*11),i.closePath(),i.fillStyle=s.accent,i.fill()}),e.config=a(function(){i.beginPath();for(var e=n/2,t=0;t<24;t++){var a=0===(2&t)?.42*n:.3*n,o=Math.PI*(t-.5)/12;0===t?i.moveTo(e+Math.cos(o)*a,e+Math.sin(o)*a):i.lineTo(e+Math.cos(o)*a,e+Math.sin(o)*a)}i.closePath(),i.arc(e,e,.15*n,0,2*Math.PI,!0),i.fillStyle=s.accent,i.fill()}),e.save=a(function(){i.beginPath(),i.moveTo(n/8,n/8),i.lineTo(n/8,n/8*7),i.lineTo(n/8*7,n/8*7),i.lineTo(n/8*7,n/4),i.lineTo(n/4*3,n/8),i.closePath(),i.moveTo(n/4,n/2),i.lineTo(n/4*3,n/2),i.lineTo(n/4*3,n/6*5),i.lineTo(n/4,n/6*5),i.closePath(),i.moveTo(n/4,n/6),i.lineTo(n/3*2,n/6),i.lineTo(n/3*2,n/8*3),i.lineTo(n/4,n/8*3),i.closePath(),i.moveTo(n/2,n/5),i.lineTo(n/8*5,n/5),i.lineTo(n/8*5,n/3),i.lineTo(n/2,n/3),i.closePath(),i.fillStyle=s.accent,i.fill()}),e};n.default=u},{"./colors":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/colors.js","./interpolator":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/interpolator.js"}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/interpolator.js":[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=e("./noise"),r=i(o),l=function(e){var t={};for(var n in e)t[n]=e[n];return t},s=function(e,t){return"number"==typeof e?e:t},u={};u.MODE_HOLD=0,u.MODE_LINEAR=1,u.MODE_SMOOTH=2,u.MODE_EXP=3,u.MODE_SPRING=4,u.MODE_GRAVITY=5,u.MODES=6,u.modeNames=["Hold","Linear","Smoothstep","Exp. Smooth","Critically Damped Spring","Gravity and Bounce"],u.MOD_RESET=0,u.MOD_SIN=1,u.MOD_NOISE=2,u.MOD_LOFI=3,u.MODS=4,u.modNames=["Reset","Sine Curve","Perlin Noise"],u.generate=function(e){for(var t="object"===("undefined"==typeof e?"undefined":a(e))?e:{},n=s(t.mode,u.MODE_LINEAR),i=s(t.start,0),o=s(t.end,1),d=s(t.length,32),m=s(t.deltaTime,.01),c="object"===a(t.mods)?l(t.mods):[],f=0;f<u.MODS;f++)c[f]=!!c[f]&&c[f];var p=[i];if(n===u.MODE_HOLD){for(var v=1;v<d;v++)p[v]=i;p[d-1]=o}else if(n===u.MODE_LINEAR)for(var h=1;h<d;h++){var g=h/(d-1);p[h]=i+(o-i)*g}else if(n===u.MODE_SMOOTH)for(var x=1;x<d;x++){var M=x/(d-1),T=M*M*(3-2*M);p[x]=i+(o-i)*T}else if(n===u.MODE_EXP)for(var b=s(t.factor,10),y=1;y<d;y++){var S=y*m,C=1-Math.exp(-b*S);p[y]=i+(o-i)*C}else if(n===u.MODE_SPRING)for(var D=s(t.rate,500),O=s(t.damp,1),w=s(t.vel,0),N=i,P=1;P<d;P++)w+=(-D*(N-o)-2*w*Math.sqrt(D)*O)*m,N+=w*m,p[P]=N;else if(n===u.MODE_GRAVITY)for(var E=s(t.gravity,70),k=s(t.bounce,.3),L=s(t.vel,0),_=Math.sign(o-i),I=i,V=1;V<d;V++)L+=E*_*m,I+=L*m,_!==Math.sign(o-I)&&(I=o+(o-I)*k,L*=-k),p[V]=I;if(c[u.MOD_SIN])for(var R=s(c[u.MOD_SIN].freq,2),Y=s(c[u.MOD_SIN].amp,.5),B=s(c[u.MOD_SIN].phase,0),j=0;j<d;j++)p[j]+=Math.sin(B*Math.PI*2)*Y,B=(B+1/(d-1)*R)%1;if(c[u.MOD_NOISE])for(var A=s(c[u.MOD_NOISE].amp,1),H=(0,r.default)({length:d,recursion:s(c[u.MOD_NOISE].recursion,3),freq:s(c[u.MOD_NOISE].freq,1)*d/(d-1),reso:s(c[u.MOD_NOISE].reso,4),seed:s(c[u.MOD_NOISE].seed,175)}),J=0;J<d;J++)p[J]+=H[J]*A;if(c[u.MOD_LOFI])for(var U=(d-1)/s(c[u.MOD_LOFI].freq,4),F=0;F<d;F++)p[F]=p[Math.ceil(Math.floor(F/U)*U)];return p},n.default=u},{"./noise":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/noise.js"}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/main.js":[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=e("./param"),r=i(o),l=e("./gui"),s=i(l),u=function(e){var t={},n="object"===("undefined"==typeof e?"undefined":a(e))?e:{},i=n.data?JSON.parse(n.data):{};if(t.time=0,t.length="number"==typeof i.length?i.length:1,t.resolution="number"==typeof i.resolution?i.resolution:1e3,t.params={},t.createParam=function(e){var n=new r.default(t);return t.params[e]=n,n},t.getParamNames=function(){var e=[];for(var n in t.params)e.push(n);return e=e.sort()},t.countParams=function(){var e=0;for(var n in t.params)e++;return e},i.params)for(var o in i.params){var l=t.createParam(o);l.load(i.params[o])}return n.gui&&(t.gui=(0,s.default)(t),i.gui&&t.gui.setState(i.gui)),t.renderAll=function(){for(var e in t.params)t.params[e].render()},t.update=function(e){t.time=e%t.length,t.gui&&t.gui.update()},t.auto=function(e){if(!t.params[e]){t.createParam(e)}return t.params[e].getValue()},t.save=function(){var e={length:t.length,resolution:t.resolution};e.params={};for(var n in t.params){var i=t.params[n];e.params[n]=i.nodes}return t.gui&&(e.gui=t.gui.getState()),e},t};t.exports=u},{"./gui":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/gui.js","./param":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/param.js"}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/noise.js":[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},o=e("./xorshift"),r=i(o),l=function(e,t,n){var i=n*n*(3-2*n);return e+(t-e)*i},s=function(e){var t="object"===("undefined"==typeof e?"undefined":a(e))?e:{length:32,recursion:6,freq:1,reso:4,seed:0};t.length=parseInt(t.length),t.recursion=parseInt(t.recursion),t.reso=parseInt(t.reso),t.seed=parseInt(t.seed);var n=[0];(0,r.default)(t.seed);for(var i=1;i<t.reso;i++)n[i]=2*(0,r.default)()-1;n.push(n[0]);for(var o=[],s=0;s<t.length;s++){o[s]=0;for(var u=s/t.length,d=0;d<t.recursion;d++){var m=u*t.freq*t.reso*Math.pow(2,d)%t.reso,c=Math.floor(m),f=m%1,p=Math.pow(2,-d-1);o[s]+=p*l(n[c],n[c+1],f)}}return o};n.default=s},{"./xorshift":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/xorshift.js"}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/param.js":[function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},l=e("./interpolator"),s=i(l),u=function(e){if("object"!==("undefined"==typeof e?"undefined":r(e)))return e;var t={};for(var n in e)t[n]=e[n];return t},d=function(){function e(t){a(this,e);var n=this;n.automaton=t,n.values=[];for(var i=Math.ceil(n.automaton.resolution*n.automaton.length)+1,o=0;o<i;o++)n.values[o]=0;n.nodes=[],n.addNode(0,0),n.addNode(n.automaton.length,1),n.render()}return o(e,[{key:"load",value:function(e){var t=this;t.nodes=e,t.render()}},{key:"sortNodes",value:function(){var e=this;e.nodes.sort(function(e,t){return e.time-t.time})}},{key:"render",value:function(e){var t=this;t.values=[];for(var n=1;n<t.nodes.length;n++){
var i=t.nodes[n-1].time,a=Math.floor(i*t.automaton.resolution),o=t.nodes[n].time,r=Math.floor(o*t.automaton.resolution),l=1===n||t.nodes[n].mods[s.default.MOD_RESET],u=t.nodes[n].mods[s.default.MOD_RESET]?t.nodes[n].mods[s.default.MOD_RESET].velocity:0,d=1/t.automaton.resolution,m={mode:t.nodes[n].mode,start:l?t.nodes[n-1].value:t.values[a],end:t.nodes[n].value,deltaTime:d,length:r-a+1,vel:!l&&2<t.values.length?(t.values[t.values.length-1]-t.values[t.values.length-2])/d:u,mods:t.nodes[n].mods};for(var c in t.nodes[n].params)m[c]=t.nodes[n].params[c];var f=s.default.generate(m);t.values.pop(),t.values=t.values.concat(f)}}},{key:"addNode",value:function(e,t){var n=this,i=n.nodes.filter(function(t){return e<t.time})[0];if(!i){i={mode:s.default.MODE_LINEAR,params:{},mods:[]};for(var a=0;a<s.default.MODS;a++)i.mods[a]=!1}var o={time:e,value:t,mode:i.mode,params:u(i.params),mods:i.mods.map(function(e){return u(e)})};return n.nodes.push(o),n.sortNodes(),n.render(),o}},{key:"setTime",value:function(e,t){var n=this;if(!(e<0||n.nodes.length<=e))return 0!==e&&n.nodes.length-1!==e&&(n.nodes[e].time=Math.min(Math.max(t,n.nodes[e-1].time+1/n.automaton.resolution),n.nodes[e+1].time-1/n.automaton.resolution),n.render()),n.nodes[e].time}},{key:"setValue",value:function(e,t){var n=this;if(!(e<0||n.nodes.length<=e))return n.nodes[e].value=t,n.render(),n.nodes[e].value}},{key:"setMode",value:function(e,t){var n=this;if(!(e<1||n.nodes.length<=e)){var i=n.nodes[e];i.mode=t,t===s.default.MODE_HOLD?i.params={}:t===s.default.MODE_LINEAR?i.params={}:t===s.default.MODE_SMOOTH?i.params={}:t===s.default.MODE_EXP?i.params={factor:10}:t===s.default.MODE_SPRING?i.params={rate:500,damp:1}:t===s.default.MODE_GRAVITY&&(i.params={gravity:70,bounce:.3}),n.render()}}},{key:"setParams",value:function(e,t){var n=this;if(!(e<0||n.nodes.length<=e)){for(var i in t)n.nodes[e].params[i]=t[i];n.render()}}},{key:"activeModParams",value:function(e,t,n){var i=this;if(!(e<0||i.nodes.length<=e||t<0||s.default.MODS<=t))if(n){i.nodes[e].mods[t]={};var a=void 0;t===s.default.MOD_RESET?a={velocity:0}:t===s.default.MOD_SIN?a={freq:5,amp:.1,phase:0}:t===s.default.MOD_NOISE?a={freq:1,amp:.2,reso:8,recursion:4,seed:1}:t===s.default.MOD_LOFI&&(a={freq:10}),i.setModParams(e,t,a)}else i.nodes[e].mods[t]=!1}},{key:"setModParams",value:function(e,t,n){var i=this;if(!(e<0||i.nodes.length<=e||t<0||s.default.MODS<=t)){for(var a in n)i.nodes[e].mods[t][a]=n[a];i.render()}}},{key:"removeNode",value:function(e){var t=this;if(!(e<1||t.nodes.length-1<=e)){var n=t.nodes.splice(e,1);return t.render(),n}}},{key:"getValue",value:function(e){var t=this,n="number"==typeof e?e:t.automaton.time;n%=t.automaton.length;var i=n*t.automaton.resolution,a=Math.floor(i),o=i%1,r=t.values[a],l=t.values[a+1];return r+(l-r)*o}}]),e}();n.default=d},{"./interpolator":"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/interpolator.js"}],"/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/xorshift.js":[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var i=void 0,a=function(e){return i=e||i||1,i^=i<<13,i^=i>>>17,i^=i<<5,i/Math.pow(2,32)+.5};n.default=a},{}]},{},["/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/main.js"])("/Users/Yutaka/Dropbox/pro/JavaScript/automaton/src/script/main.js")});