<!DOCTYPE html>

<meta charset="UTF-8">
<title></title>



<style>
body {
  background: #222;
  color: #ddd;
  font: 500 16px/1.2 "Helvetica Neue", "ãƒ’ãƒ©ã‚®ãƒŽè§’ã‚´ ProN", sans-serif;
}

#divAutomatonContainer {
  position: fixed;
  left: 0;
  bottom: 0;
  width: 100%;
  height: 240px;
}

#canvas {
  position: fixed;
  top: 0;
  left: 0;
}

#text {
  white-space: pre-wrap;
  width: 60%;

  padding-top: 250px;
  padding-bottom: 250px;
}

#editor {
  position: fixed;
  width: 40%;
  height: calc( 100% - 240px );
  right: 0;
  top: 0;
}

a {
  color: #f8a;
}

h1 {
  margin-bottom: 0;
}

code {
  padding: 4px;
  background: #444;
  border-radius: 4px;
}
</style>

<body>
  <div id="container">
    <div id="divAutomatonContainer">
    </div>
    
    <canvas id="canvas"></canvas>

    <div id="text">
<h1>Automaton Playground!</h1>
Hi there! This is Automaton playground.
You can code anything (not dangerous) on editor and tweak parameters on Automaton GUI.

GitHub (Download): <a href="https://github.com/fms-cat/automaton">https://github.com/fms-cat/automaton</a>

<h1>What is Automaton?</h1>
Automaton is animation tool with Timeline GUI for art coding.
I hope it helps your creative coding!
Automaton is under development so some features will be added / changed in future.

I defined the function named <code>auto</code> like <code>let auto = automaton.auto</code> .
You can use <code>auto</code> as numeric parameter which is tweakable on Automaton GUI.
When you use <code>auto</code> like <code>auto( "rectX" )</code>, new parameter named "rectX" created on Automaton, and it appears on GUI.
Then, you can tweak the parameter using timeline on GUI.

Be careful that you cannot use Automaton parameter outside the update loop.
It will create the new parameter on Automaton, but not updated.
If you want to define tweakable parameters outside the update loop, you need to assign the parameter inside the update loop via <code>auto</code>.

<h1>How to use GUI</h1>
The Automaton GUI has a lot of feature!

First, choose the parameter you want to tweak by left menu.
Then the GUI will be show parameter animation curve on timeline.

When you <code>doubleclick</code> inside the timeline, new "node" will be created.
The animation curve will transform to pass through nodes.
You can grab and move around the node by <code>drag</code>ging.
And you <code>doubleclick</code> the node, the node will be removed.

You can scroll around the timeline using mouse <code>wheel</code>.
<code>Shift-Scroll</code> lets the timeline horizontal zoom.
<code>Alt-Scroll</code> lets the timeline vertical zoom.

Shape of animation curve can be changed by menu on the right side.
You can use various curve such as Linear, ExpSmooth, Spring, etc...
Or, you can apply some "mods" to the curve such as SineCurve, PerlinNoise, Lo-Fi, etc...
Let's try various!

<h1>Other Features</h1>
I'll explain about icons above timeline.

First, you click magnet icon, you can configure BeatSnap.
BeatSnap lets nodes snaps to beat.
It is very useful to making audio-syncing animations.

Next, you click cog icon, it will show global setting.
You can change the length and resolution.
Less resolution, less memory consumption and less curve generating time, but also it will make the curve rough.

Finally, you click save icon, it will show (very long) JSON contains all of Automaton parameters.
You can load this JSON by adding parameter named <code>data</code> when you instantiate Automaton.
    </div>

    <div id="editor">// Press Ctrl+S (Cmd+S on MacOS) to run script
// The script will be run under ðŸ”¥ eval() ðŸ”¥. be calm, safety first.

// generate automaton instance
var automaton = new Automaton( {
  gui: divAutomatonContainer,
  realtime: true,
  loop: true,
  data: `
  {"v":"2.0.0","length":5,"resolution":1000,"params":{"rectX":{"nodes":[{"time":0,"value":0.2,"out":{"time":0.5,"value":0}},{"time":1,"value":1.2,"in":{"time":-0.5,"value":0},"out":{"time":0,"value":0}},{"time":1.1,"value":0,"in":{"time":0,"value":0},"out":{"time":0,"value":0}},{"time":2.2,"value":0,"in":{"time":0,"value":0},"out":{"time":0,"value":0}},{"time":2.683168316831683,"value":0.5250214539209881,"in":{"time":-0.016859292538467466,"value":-0.4624110643758043},"out":{"time":0.06450267043302052,"value":1.7691577758651331}},{"time":3.0792079207920793,"value":1.5,"in":{"time":-0.26237623762376217,"value":0},"out":{"time":0,"value":0}},{"time":4,"value":1.5,"in":{"time":0,"value":0},"out":{"time":0.5,"value":0}},{"time":5,"value":0.2,"in":{"time":-0.22277227722772253,"value":0.8699159412838409}}],"fxs":[{"time":1,"length":1.2,"row":0,"def":"gravity","params":{"a":20,"e":0.5,"preserve":false},"bypass":false},{"time":2.2,"length":1.8,"row":0,"def":"cds","params":{"factor":1000,"ratio":0.15,"preserve":true},"bypass":false},{"time":4,"length":1,"row":0,"def":"sine","params":{"amp":0.2,"freq":2,"phase":0}},{"def":"lofi","bypass":false,"row":1,"time":4.5,"length":0.5,"params":{"resolution":20,"relative":true}}]},"rectY":{"nodes":[{"time":0,"value":0,"out":{"time":0.5,"value":0}},{"time":5,"value":1,"in":{"time":-0.5,"value":0}}],"fxs":[]}}}
  `
} );

// define an auto function
var auto = automaton.auto;

var width = canvas.width = 300;
var height = canvas.height = 300;

var context = canvas.getContext( "2d" );

var stop = false;
function update() {
  if ( stop ) { return; }
  
  // pass time to automaton and update it
  automaton.update();

  context.fillStyle = "#fff";
  context.fillRect( 0, 0, width, height );
  
  context.fillStyle = "#f00";

  // here's the auto function!
  context.fillRect(
    auto( "rectX" ) * 100,
    auto( "rectY" ) * 100,
    100,
    100
  );
  
  requestAnimationFrame( update ); // rAF fps = 60
}
update();

playground.unload = function() {
  stop = true;
  automaton = null;
}</div>
  </div>
</body>

<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js"></script>
<script src="./dist/automaton.js"></script>
<script>

let editor = ace.edit( "editor" );
editor.setTheme( "ace/theme/monokai" );
editor.getSession().setMode( "ace/mode/javascript" );
editor.getSession().setTabSize( 2 );
editor.getSession().setUseSoftTabs( true );

let playground = {};

let run = () => {
  let source = editor.getValue();
  if ( typeof playground.unload === "function" ) { playground.unload(); }
  try {
    let func = eval( source );
  } catch ( exception ) {
    console.error( exception );
    alert( "An error occured! See browser console (Ctrl+Shift+J in chrome)." );
  }
};
run();

editor.commands.addCommand( {
  name: "run",
  bindKey: { win: "Ctrl-S",  mac: "Command-S" },
  exec: () => run()
} );

</script>